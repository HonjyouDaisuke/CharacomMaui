<?xml version="1.0" encoding="utf-8" ?>
<ContentView
  x:Class="CharacomMaui.Presentation.Components.CharaDataProgressRow"
  xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
  xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
  xmlns:models="clr-namespace:CharacomMaui.Presentation.Models"
  xmlns:conv="clr-namespace:CharacomMaui.Presentation.Converters"
  x:Name="This">


  <!-- ✅ Resources -->
  <ContentView.Resources>
    <ResourceDictionary>

      <conv:OddConverter x:Key="OddConverter"/>

      <Style x:Key="ProgressRowBackgroundStyle"
             TargetType="Grid">

        <Setter Property="VisualStateManager.VisualStateGroups">
          <VisualStateGroupList>

            <VisualStateGroup x:Name="RowStates">

              <!-- 偶数行（非選択） -->
              <VisualState x:Name="NormalEven">
                <VisualState.Setters>
                  <Setter Property="BackgroundColor"
                          Value="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}"/>
                </VisualState.Setters>
              </VisualState>

              <!-- 奇数行（非選択） -->
              <VisualState x:Name="NormalOdd">
                <VisualState.Setters>
                  <Setter Property="BackgroundColor"
                          Value="{AppThemeBinding Light={StaticResource SurfaceAlt}, Dark={StaticResource SurfaceAltDark}}"/>
                </VisualState.Setters>
              </VisualState>

              <!-- 選択 -->
              <VisualState x:Name="Selected">
                <VisualState.Setters>
                  <Setter Property="BackgroundColor"
                          Value="{AppThemeBinding Light={StaticResource Secondary}, Dark={StaticResource SecondaryDark}}"/>
                </VisualState.Setters>
              </VisualState>

            </VisualStateGroup>

          </VisualStateGroupList>
        </Setter>
      </Style>


    </ResourceDictionary>
  </ContentView.Resources>

  <!-- ✅ GestureRecognizers はこれだけ -->
  <ContentView.GestureRecognizers>
    <TapGestureRecognizer Tapped="OnCardTapped"/>
  </ContentView.GestureRecognizers>

  <Grid RowDefinitions="*, Auto"
        IsEnabled="True">

    <Grid x:Name="BackgroundBorder"
          Style="{StaticResource ProgressRowBackgroundStyle}"
          Margin="20,5,20,5"
          Padding="5"
          Grid.Row="0"
          IsEnabled="True"
          ColumnSpacing="10">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="1*"/>
        <ColumnDefinition Width="1*"/>
        <ColumnDefinition Width="1*"/>
        <ColumnDefinition Width="1*"/>
        <ColumnDefinition Width="10*"/>
      </Grid.ColumnDefinitions>

      <Label Grid.Column="0"
             HorizontalTextAlignment="Center"
             x:Name="CharaNameLabel"
             Text="{Binding CharaName, Source={x:Reference This}}"/>

      <Label Grid.Column="1"
             HorizontalTextAlignment="Center"
             x:Name="MaterialNameLabel"
             Text="{Binding MaterialName, Source={x:Reference This}}"/>

      <Label Grid.Column="2"
             HorizontalTextAlignment="End"
             x:Name="CharaCountLabel"
             Text="{Binding CharaCount, Source={x:Reference This}}"/>

      <Label Grid.Column="3"
             HorizontalTextAlignment="End"
             x:Name="SelectedCountLabel"
             Text="{Binding SelectedCount, Source={x:Reference This}}"/>

      <AbsoluteLayout x:Name="ProgressRoot"
                      Grid.Column="4"
                      IsEnabled="True"
                      HeightRequest="30">
        <!-- 背景 -->
        <BoxView
          Color="{AppThemeBinding Light={StaticResource DisabledBackground}, Dark={StaticResource DisabledBackgroundDark}}"
          AbsoluteLayout.LayoutBounds="0,0,1,1"
          AbsoluteLayout.LayoutFlags="All"
          CornerRadius="4"/>

        <!-- 進捗 -->
        <BoxView x:Name="SelectedBar"
                 IsEnabled="True"
                 InputTransparent="True"
                 Color="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                 AbsoluteLayout.LayoutBounds="0,0,0,1"
                 AbsoluteLayout.LayoutFlags="All"
                 CornerRadius="4"/>
      </AbsoluteLayout>
    </Grid>

    <!-- 下線 -->
    <BoxView Grid.Row="1"
             Margin="20,0,20,0"
             HeightRequest="1"
             BackgroundColor="{AppThemeBinding Light={StaticResource Surface}, Dark={StaticResource SurfaceDark}}"
             HorizontalOptions="Fill"/>
  </Grid>

</ContentView>